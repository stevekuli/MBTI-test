{"version":3,"file":"index.js","sources":["../../src/utils/index.ts"],"sourcesContent":["/* eslint-disable prefer-promise-reject-errors */\nimport Taro from '@tarojs/api'\nimport { Current, getCurrentPage, getHomePage, hooks } from '@tarojs/runtime'\nimport { isFunction } from '@tarojs/shared'\n\nimport { MethodHandler } from './handler'\n\nimport type { TaroElement } from '@tarojs/runtime'\n\nexport function shouldBeObject (target: unknown) {\n  if (target && typeof target === 'object') return { flag: true }\n  return {\n    flag: false,\n    msg: getParameterError({\n      correct: 'Object',\n      wrong: target\n    })\n  }\n}\n\nexport function findDOM (inst?): TaroElement | HTMLElement | undefined {\n  if (inst && hooks.isExist('getDOMNode')) {\n    return hooks.call('getDOMNode', inst)\n  }\n\n  const page = Current.page\n  const path = page?.path\n  const msg = '没有找到已经加载了的页面，请在页面加载完成后使用此 API。'\n  if (path == null) {\n    throw new Error(msg)\n  }\n\n  const el = document.getElementById(path)\n  if (el == null) {\n    throw new Error('在已加载页面中没有找到对应的容器元素。')\n  }\n\n  return el\n}\n\ninterface IParameterErrorParam {\n  name?: string\n  para?: string\n  correct?: string\n  wrong?: unknown\n  level?: 'warn' | 'error' | 'log' | 'info' | 'debug'\n}\nexport function getParameterError ({ name = '', para, correct, wrong, level = 'error' }: IParameterErrorParam) {\n  const parameter = para ? `parameter.${para}` : 'parameter'\n  const errorType = upperCaseFirstLetter(wrong === null ? 'Null' : typeof wrong)\n  return `${name ? `${name}:fail ` : ''}parameter ${level}: ${parameter} should be ${correct} instead of ${errorType}`\n}\n\nexport function upperCaseFirstLetter (string) {\n  if (typeof string !== 'string') return string\n  string = string.replace(/^./, match => match.toUpperCase())\n  return string\n}\n\nexport function inlineStyle (style) {\n  let res = ''\n  for (const attr in style) res += `${attr}: ${style[attr]};`\n  if (res.indexOf('display: flex;') >= 0) res += 'display: -webkit-box;display: -webkit-flex;'\n  res = res.replace(/transform:(.+?);/g, (s, $1) => `${s}-webkit-transform:${$1};`)\n  res = res.replace(/flex-direction:(.+?);/g, (s, $1) => `${s}-webkit-flex-direction:${$1};`)\n  return res\n}\n\nexport function setTransform (el, val) {\n  el.style.webkitTransform = val\n  el.style.transform = val\n}\n\nexport function serializeParams (params) {\n  if (!params) {\n    return ''\n  }\n  return Object.keys(params)\n    .map(key => (\n      `${encodeURIComponent(key)}=${typeof (params[key]) === 'object'\n        ? encodeURIComponent(JSON.stringify(params[key]))\n        : encodeURIComponent(params[key])}`))\n    .join('&')\n}\n\nexport function temporarilyNotSupport (name = '') {\n  return (option = {}, ...args) => {\n    const { success, fail, complete } = option as any\n    const handle = new MethodHandler({ name, success, fail, complete })\n    const errMsg = '暂时不支持 API'\n    Taro.eventCenter.trigger('__taroNotSupport', {\n      name,\n      args: [option, ...args],\n      type: 'method',\n      category: 'temporarily',\n    })\n    if (process.env.NODE_ENV === 'production') {\n      console.warn(errMsg)\n      return handle.success({ errMsg })\n    } else {\n      return handle.fail({ errMsg })\n    }\n  }\n}\n\nexport function weixinCorpSupport (name: string) {\n  return (option = {}, ...args) => {\n    const { success, fail, complete } = option as any\n    const handle = new MethodHandler({ name, success, fail, complete })\n    const errMsg = 'h5 端当前仅在微信公众号 JS-SDK 环境下支持此 API'\n    Taro.eventCenter.trigger('__taroNotSupport', {\n      name,\n      args: [option, ...args],\n      type: 'method',\n      category: 'weixin_corp',\n    })\n    if (process.env.NODE_ENV === 'production') {\n      console.warn(errMsg)\n      return handle.success({ errMsg })\n    } else {\n      return handle.fail({ errMsg })\n    }\n  }\n}\n\nexport function permanentlyNotSupport (name = '') {\n  return (option = {}, ...args: any[]) => {\n    const { success, fail, complete } = option as any\n    const handle = new MethodHandler({ name, success, fail, complete })\n    const errMsg = '不支持 API'\n    Taro.eventCenter.trigger('__taroNotSupport', {\n      name,\n      args: [option, ...args],\n      type: 'method',\n      category: 'permanently',\n    })\n    if (process.env.NODE_ENV === 'production') {\n      console.warn(errMsg)\n      return handle.success({ errMsg })\n    } else {\n      return handle.fail({ errMsg })\n    }\n  }\n}\n\ninterface IProcessOpenApi<TOptions = Record<string, unknown>, TResult extends TaroGeneral.CallbackResult = any> {\n  name: string\n  defaultOptions?: TOptions\n  standardMethod?: (opts: TOptions) => Promise<TResult>\n  formatOptions?: (opts: TOptions) => TOptions\n  formatResult?: (res: TResult) => TResult\n}\n\nexport function processOpenApi<TOptions = Record<string, unknown>, TResult extends TaroGeneral.CallbackResult = any> ({\n  name,\n  defaultOptions,\n  standardMethod,\n  formatOptions = options => options,\n  formatResult = res => res\n}: IProcessOpenApi<TOptions, TResult>) {\n  const notSupported = weixinCorpSupport(name)\n  return (options: Partial<TOptions> = {}, ...args: any[]): Promise<TResult> => {\n    // @ts-ignore\n    const targetApi = window?.wx?.[name]\n    const opts = formatOptions(Object.assign({}, defaultOptions, options))\n    if (isFunction(targetApi)) {\n      return new Promise<TResult>((resolve, reject) => {\n        ['fail', 'success', 'complete'].forEach(k => {\n          opts[k] = preRef => {\n            const res = formatResult(preRef)\n            options[k] && options[k](res)\n            if (k === 'success') {\n              resolve(res)\n            } else if (k === 'fail') {\n              reject(res)\n            }\n          }\n          return targetApi(opts)\n        })\n      })\n    } else if (isFunction(standardMethod)) {\n      return standardMethod(opts)\n    } else {\n      return notSupported(options, ...args) as Promise<TResult>\n    }\n  }\n}\n\n/**\n * 获取当前页面路径\n * @returns\n */\nexport function getCurrentPath (): string {\n  const appConfig = (window as any).__taroAppConfig || {}\n  const routePath = getCurrentPage(appConfig.router?.mode, appConfig.router?.basename)\n  const homePath = getHomePage(appConfig.routes?.[0]?.path, appConfig.router?.basename, appConfig.router?.customRoutes, appConfig.entryPagePath)\n\n  /**\n   * createPageConfig 时根据 stack 的长度来设置 stamp 以保证页面 path 的唯一，此函数是在 createPageConfig 之前调用，预先设置 stamp=1\n   * url 上没有指定应用的启动页面时使用 homePath\n   */\n  return `${routePath === '/' ? homePath : routePath}?stamp=1`\n}\n\nexport * from './animation'\nexport * from './helper'\nexport * from './valid'\n"],"names":[],"mappings":"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"}