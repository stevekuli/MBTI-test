{"version":3,"file":"getLocation.js","sources":["../../../src/api/location/getLocation.ts"],"sourcesContent":["import Taro from '@tarojs/api'\n\nimport { processOpenApi, shouldBeObject } from '../../utils'\nimport { MethodHandler } from '../../utils/handler'\nimport { isGeolocationSupported } from './utils'\n\nconst getLocationByW3CApi: (options: Taro.getLocation.Option) => Promise<Taro.getLocation.SuccessCallbackResult> = (options: Taro.getLocation.Option): Promise<Taro.getLocation.SuccessCallbackResult> => {\n  // 断言 options 必须是 Object\n  const isObject = shouldBeObject(options)\n  if (!isObject.flag) {\n    const res = { errMsg: `getLocation:fail ${isObject.msg}` }\n    console.error(res.errMsg)\n    return Promise.reject(res)\n  }\n\n  // 解构回调函数\n  const { success, fail, complete } = options\n\n  const handle = new MethodHandler({ name: 'getLocation', success, fail, complete })\n\n  // const defaultMaximumAge = 5 * 1000\n\n  const positionOptions: PositionOptions = {\n    enableHighAccuracy: options.isHighAccuracy || (options.altitude != null), // 海拔定位需要高精度\n    // maximumAge: defaultMaximumAge, // 允许取多久以内的缓存位置\n    timeout: options.highAccuracyExpireTime // 高精度定位超时时间\n  }\n\n  // Web端API实现暂时仅支持GPS坐标系\n  if (options.type?.toUpperCase() !== 'WGS84') {\n    return handle.fail({\n      errMsg: 'This coordinate system type is not temporarily supported'\n    })\n  }\n\n  // 判断当前浏览器是否支持位置API\n  if (!isGeolocationSupported()) {\n    return handle.fail({\n      errMsg: 'The current browser does not support this feature'\n    })\n  }\n\n  // 开始获取位置\n  return new Promise<Taro.getLocation.SuccessCallbackResult>(\n    (resolve, reject) => {\n      navigator.geolocation.getCurrentPosition(\n        (position) => {\n          const result: Taro.getLocation.SuccessCallbackResult = {\n            /** 位置的精确度 */\n            accuracy: position.coords.accuracy,\n            /** 高度，单位 m */\n            altitude: position.coords.altitude!,\n            /** 水平精度，单位 m */\n            horizontalAccuracy: position.coords.accuracy,\n            /** 纬度，范围为 -90~90，负数表示南纬 */\n            latitude: position.coords.latitude,\n            /** 经度，范围为 -180~180，负数表示西经 */\n            longitude: position.coords.longitude,\n            /** 速度，单位 m/s */\n            speed: position.coords.speed!,\n            /** 垂直精度，单位 m（Android 无法获取，返回 0） */\n            verticalAccuracy: position.coords.altitudeAccuracy || 0,\n            /** 调用结果,自动补充 */\n            errMsg: ''\n          }\n          handle.success(result, { resolve, reject })\n        },\n        (error) => {\n          handle.fail({ errMsg: error.message }, { resolve, reject })\n        },\n        positionOptions\n      )\n    }\n  )\n}\n\nexport const getLocation = /* @__PURE__ */ processOpenApi({\n  name: 'getLocation',\n  standardMethod: getLocationByW3CApi\n})\n"],"names":[],"mappings":";;;;AAMA,MAAM,mBAAmB,GAA0F,CAAC,OAAgC,KAAqD;;;AAEvM,IAAA,MAAM,QAAQ,GAAG,cAAc,CAAC,OAAO,CAAC,CAAA;AACxC,IAAA,IAAI,CAAC,QAAQ,CAAC,IAAI,EAAE;QAClB,MAAM,GAAG,GAAG,EAAE,MAAM,EAAE,CAAoB,iBAAA,EAAA,QAAQ,CAAC,GAAG,CAAE,CAAA,EAAE,CAAA;AAC1D,QAAA,OAAO,CAAC,KAAK,CAAC,GAAG,CAAC,MAAM,CAAC,CAAA;AACzB,QAAA,OAAO,OAAO,CAAC,MAAM,CAAC,GAAG,CAAC,CAAA;AAC3B,KAAA;;IAGD,MAAM,EAAE,OAAO,EAAE,IAAI,EAAE,QAAQ,EAAE,GAAG,OAAO,CAAA;AAE3C,IAAA,MAAM,MAAM,GAAG,IAAI,aAAa,CAAC,EAAE,IAAI,EAAE,aAAa,EAAE,OAAO,EAAE,IAAI,EAAE,QAAQ,EAAE,CAAC,CAAA;;AAIlF,IAAA,MAAM,eAAe,GAAoB;QACvC,kBAAkB,EAAE,OAAO,CAAC,cAAc,KAAK,OAAO,CAAC,QAAQ,IAAI,IAAI,CAAC;;AAExE,QAAA,OAAO,EAAE,OAAO,CAAC,sBAAsB;KACxC,CAAA;;IAGD,IAAI,CAAA,CAAA,EAAA,GAAA,OAAO,CAAC,IAAI,0CAAE,WAAW,EAAE,MAAK,OAAO,EAAE;QAC3C,OAAO,MAAM,CAAC,IAAI,CAAC;AACjB,YAAA,MAAM,EAAE,0DAA0D;AACnE,SAAA,CAAC,CAAA;AACH,KAAA;;IAGD,IAAI,CAAC,sBAAsB,EAAE,EAAE;QAC7B,OAAO,MAAM,CAAC,IAAI,CAAC;AACjB,YAAA,MAAM,EAAE,mDAAmD;AAC5D,SAAA,CAAC,CAAA;AACH,KAAA;;IAGD,OAAO,IAAI,OAAO,CAChB,CAAC,OAAO,EAAE,MAAM,KAAI;QAClB,SAAS,CAAC,WAAW,CAAC,kBAAkB,CACtC,CAAC,QAAQ,KAAI;AACX,YAAA,MAAM,MAAM,GAA2C;;AAErD,gBAAA,QAAQ,EAAE,QAAQ,CAAC,MAAM,CAAC,QAAQ;;AAElC,gBAAA,QAAQ,EAAE,QAAQ,CAAC,MAAM,CAAC,QAAS;;AAEnC,gBAAA,kBAAkB,EAAE,QAAQ,CAAC,MAAM,CAAC,QAAQ;;AAE5C,gBAAA,QAAQ,EAAE,QAAQ,CAAC,MAAM,CAAC,QAAQ;;AAElC,gBAAA,SAAS,EAAE,QAAQ,CAAC,MAAM,CAAC,SAAS;;AAEpC,gBAAA,KAAK,EAAE,QAAQ,CAAC,MAAM,CAAC,KAAM;;AAE7B,gBAAA,gBAAgB,EAAE,QAAQ,CAAC,MAAM,CAAC,gBAAgB,IAAI,CAAC;;AAEvD,gBAAA,MAAM,EAAE,EAAE;aACX,CAAA;YACD,MAAM,CAAC,OAAO,CAAC,MAAM,EAAE,EAAE,OAAO,EAAE,MAAM,EAAE,CAAC,CAAA;AAC7C,SAAC,EACD,CAAC,KAAK,KAAI;AACR,YAAA,MAAM,CAAC,IAAI,CAAC,EAAE,MAAM,EAAE,KAAK,CAAC,OAAO,EAAE,EAAE,EAAE,OAAO,EAAE,MAAM,EAAE,CAAC,CAAA;SAC5D,EACD,eAAe,CAChB,CAAA;AACH,KAAC,CACF,CAAA;AACH,CAAC,CAAA;AAEY,MAAA,WAAW,mBAAmB,cAAc,CAAC;AACxD,IAAA,IAAI,EAAE,aAAa;AACnB,IAAA,cAAc,EAAE,mBAAmB;AACpC,CAAA;;;;"}