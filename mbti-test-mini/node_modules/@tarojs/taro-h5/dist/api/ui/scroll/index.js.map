{"version":3,"file":"index.js","sources":["../../../../src/api/ui/scroll/index.ts"],"sourcesContent":["import Taro from '@tarojs/api'\r\nimport { Current } from '@tarojs/runtime'\r\n\r\nimport { easeInOut, getTimingFunc } from '../../../utils'\r\nimport { MethodHandler } from '../../../utils/handler'\r\n\r\nlet timer: ReturnType<typeof setTimeout>\r\nconst FRAME_DURATION = 17\r\n\r\n/**\r\n * 将页面滚动到目标位置\r\n */\r\nexport const pageScrollTo: typeof Taro.pageScrollTo = ({ scrollTop, selector = '', offsetTop = 0, duration = 300, success, fail, complete }) => {\r\n  let scrollFunc\r\n  const handle = new MethodHandler({ name: 'pageScrollTo', success, fail, complete })\r\n  return new Promise((resolve, reject) => {\r\n    try {\r\n      if (scrollTop === undefined && !selector) {\r\n        return handle.fail({\r\n          errMsg: 'scrollTop\" 或 \"selector\" 需要其之一'\r\n        }, { resolve, reject })\r\n      }\r\n\r\n      const usingWindowScroll = (window as any).__taroAppConfig?.usingWindowScroll\r\n      const id = Current.page?.path?.replace(/([^a-z0-9\\u00a0-\\uffff_-])/ig, '\\\\$1')\r\n      const el: HTMLDivElement | null = (id\r\n        ? document.querySelector(`.taro_page#${id}`)\r\n        : document.querySelector('.taro_page') ||\r\n      document.querySelector('.taro_router')) as HTMLDivElement\r\n\r\n      if (!scrollFunc) {\r\n        if (usingWindowScroll) {\r\n          scrollFunc = pos => {\r\n            if (pos === undefined) {\r\n              return window.pageYOffset\r\n            } else {\r\n              window.scrollTo(0, pos)\r\n            }\r\n          }\r\n        } else {\r\n          scrollFunc = pos => {\r\n            if (pos === undefined) {\r\n              return el.scrollTop\r\n            } else {\r\n              el.scrollTop = pos\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      if (scrollTop && selector) {\r\n        console.warn('\"scrollTop\" 或 \"selector\" 建议只设一个值，全部设置会忽略selector')\r\n      }\r\n      const from = scrollFunc()\r\n      let to: number\r\n      if (selector) {\r\n        const el = document.querySelector(selector) as HTMLElement\r\n        to = (el?.offsetTop || 0) + offsetTop\r\n      } else {\r\n        to = typeof scrollTop === 'number' ? scrollTop : 0\r\n      }\r\n      const delta = to - from\r\n\r\n      const frameCnt = duration / FRAME_DURATION\r\n      const easeFunc = getTimingFunc(easeInOut, frameCnt)\r\n\r\n      const scroll = (frame = 0) => {\r\n        const dest = from + delta * easeFunc(frame)\r\n        scrollFunc(dest)\r\n        if (frame < frameCnt) {\r\n          timer && clearTimeout(timer)\r\n          timer = setTimeout(() => {\r\n            scroll(frame + 1)\r\n          }, FRAME_DURATION)\r\n        } else {\r\n          return handle.success({}, { resolve, reject })\r\n        }\r\n      }\r\n      scroll()\r\n    } catch (e) {\r\n      return handle.fail({\r\n        errMsg: e.message\r\n      }, { resolve, reject })\r\n    }\r\n  })\r\n}\r\n"],"names":[],"mappings":"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"}