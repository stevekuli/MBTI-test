{"version":3,"file":"utils.js","sources":["../../../src/api/network/utils.ts"],"sourcesContent":["/**\r\n * HTTP Response Header 事件回调函数的参数\r\n * @typedef {Object} HeadersReceivedParam\r\n * @property {Object} header 开发者服务器返回的 HTTP Response Header\r\n */\r\n\r\n/**\r\n * HTTP Response Header 事件的回调函数\r\n * @callback HeadersReceivedCallback\r\n * @param {HeadersReceivedParam} res 参数\r\n */\r\n\r\n/**\r\n * 进度变化回调函数的参数\r\n * @typedef {Object} ProgressUpdateParam\r\n * @property {number} progress 进度百分比\r\n * @property {number} [totalBytesWritten] 已经下载的数据长度，单位 Bytes\r\n * @property {number} [totalBytesSent] 已经上传的数据长度，单位 Bytes\r\n * @property {number} [totalBytesExpectedToWrite] 预期需要下载的数据总长度，单位 Bytes\r\n * @property {number} [totalBytesExpectedToSend] 预期需要上传的数据总长度，单位 Bytes\r\n */\r\n\r\n/**\r\n * 进度变化事件的回调函数\r\n * @callback ProgressUpdateCallback\r\n * @param {ProgressUpdateParam} res 参数\r\n */\r\n\r\nexport const NETWORK_TIMEOUT = 60000\r\n\r\nexport const XHR_STATS = {\r\n  UNSENT: 0, // Client has been created. open() not called yet.\r\n  OPENED: 1, // open() has been called.\r\n  HEADERS_RECEIVED: 2, // send() has been called, and headers and status are available.\r\n  LOADING: 3, // Downloading; responseText holds partial data.\r\n  DONE: 4 // The operation is complete.\r\n}\r\n\r\n/**\r\n * 设置xhr的header\r\n * @param {XMLHttpRequest} xhr\r\n * @param {Object} header\r\n */\r\nexport const setHeader = (xhr, header) => {\r\n  let headerKey\r\n  for (headerKey in header) {\r\n    xhr.setRequestHeader(headerKey, header[headerKey])\r\n  }\r\n}\r\n\r\n/**\r\n * 将 blob url 转化为文件\r\n * @param {string} url 要转换的 blob url\r\n * @returns {Promise<File>}\r\n */\r\nexport const convertObjectUrlToBlob = url => {\r\n  return new Promise((resolve, reject) => {\r\n    const xhr = new XMLHttpRequest()\r\n    xhr.open('GET', url, true)\r\n    xhr.responseType = 'blob'\r\n    xhr.withCredentials = true\r\n    xhr.onload = function () {\r\n      if (this.status === 200) {\r\n        resolve(this.response)\r\n      } else {\r\n        /* eslint-disable prefer-promise-reject-errors */\r\n        reject({ status: this.status })\r\n      }\r\n    }\r\n    xhr.send()\r\n  })\r\n}\r\n"],"names":[],"mappings":"AAAA;;;;AAIG;AAEH;;;;AAIG;AAEH;;;;;;;;AAQG;AAEH;;;;AAIG;AAEI,MAAM,eAAe,GAAG,MAAK;AAEvB,MAAA,SAAS,GAAG;AACvB,IAAA,MAAM,EAAE,CAAC;AACT,IAAA,MAAM,EAAE,CAAC;AACT,IAAA,gBAAgB,EAAE,CAAC;AACnB,IAAA,OAAO,EAAE,CAAC;IACV,IAAI,EAAE,CAAC;EACR;AAED;;;;AAIG;MACU,SAAS,GAAG,CAAC,GAAG,EAAE,MAAM,KAAI;AACvC,IAAA,IAAI,SAAS,CAAA;IACb,KAAK,SAAS,IAAI,MAAM,EAAE;QACxB,GAAG,CAAC,gBAAgB,CAAC,SAAS,EAAE,MAAM,CAAC,SAAS,CAAC,CAAC,CAAA;AACnD,KAAA;AACH,EAAC;AAED;;;;AAIG;AACU,MAAA,sBAAsB,GAAG,GAAG,IAAG;IAC1C,OAAO,IAAI,OAAO,CAAC,CAAC,OAAO,EAAE,MAAM,KAAI;AACrC,QAAA,MAAM,GAAG,GAAG,IAAI,cAAc,EAAE,CAAA;QAChC,GAAG,CAAC,IAAI,CAAC,KAAK,EAAE,GAAG,EAAE,IAAI,CAAC,CAAA;AAC1B,QAAA,GAAG,CAAC,YAAY,GAAG,MAAM,CAAA;AACzB,QAAA,GAAG,CAAC,eAAe,GAAG,IAAI,CAAA;QAC1B,GAAG,CAAC,MAAM,GAAG,YAAA;AACX,YAAA,IAAI,IAAI,CAAC,MAAM,KAAK,GAAG,EAAE;AACvB,gBAAA,OAAO,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAA;AACvB,aAAA;AAAM,iBAAA;;gBAEL,MAAM,CAAC,EAAE,MAAM,EAAE,IAAI,CAAC,MAAM,EAAE,CAAC,CAAA;AAChC,aAAA;AACH,SAAC,CAAA;QACD,GAAG,CAAC,IAAI,EAAE,CAAA;AACZ,KAAC,CAAC,CAAA;AACJ;;;;"}