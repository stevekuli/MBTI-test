{"version":3,"file":"waterfall.js","sources":["../../../../src/components/virtual-waterfall/react/waterfall.ts"],"sourcesContent":["import { isNumber } from '@tarojs/shared'\nimport classNames from 'classnames'\nimport memoizeOne from 'memoize-one'\nimport React from 'react'\n\nimport { cancelTimeout, convertNumber2PX, defaultItemKey, getRectSizeSync, getScrollViewContextNode, omit, requestTimeout } from '../../../utils'\nimport { IS_SCROLLING_DEBOUNCE_INTERVAL } from '../constants'\nimport ListMap from '../list-map'\nimport Preset, { type IProps } from '../preset'\n\ninterface IState {\n  instance: Waterfall\n  isScrolling: boolean\n  scrollDirection: 'forward' | 'backward'\n  scrollOffset: number\n  scrollUpdateWasRequested: boolean\n  refreshCount: number\n}\n\nexport default class Waterfall extends React.PureComponent<IProps, IState> {\n  static defaultProps: IProps = {\n    itemData: undefined,\n    overscanDistance: 50,\n    useIsScrolling: false,\n    shouldResetStyleCacheOnItemSizeChange: true\n  }\n\n  itemMap: ListMap\n  preset: Preset\n\n  constructor (props: IProps) {\n    super(props)\n\n    this.preset = new Preset(\n      props,\n      this.refresh,\n    )\n    const id = this.props.id || this.preset.id\n    this.preset.updateWrapper(id)\n    this.itemMap = this.preset.itemMap\n\n    this.state = {\n      instance: this,\n      isScrolling: false,\n      scrollDirection: 'forward',\n      scrollOffset:\n        typeof this.props.initialScrollOffset === 'number'\n          ? this.props.initialScrollOffset\n          : 0,\n      scrollUpdateWasRequested: false,\n      refreshCount: 0,\n    }\n  }\n\n  refresh = () => {\n    if (process.env.FRAMEWORK === 'preact') {\n      this.forceUpdate()\n    } else {\n      this.setState(({ refreshCount }) => ({\n        refreshCount: ++refreshCount\n      }))\n    }\n  }\n\n  _outerRef = undefined\n\n  _resetIsScrollingTimeoutId = null\n\n  _callOnItemsRendered = memoizeOne((columnIndex, overscanStartIndex, overscanStopIndex) => this.props.onItemsRendered({\n    columnIndex,\n    overscanStartIndex,\n    overscanStopIndex,\n  }))\n\n  _callOnScroll = memoizeOne((scrollDirection, scrollOffset, scrollUpdateWasRequested, detail) => this.props.onScroll({\n    scrollDirection,\n    scrollOffset,\n    scrollUpdateWasRequested,\n    detail\n  } as any))\n\n  _callPropsCallbacks (prevProps: any = {}, prevState: any = {}) {\n    if (typeof this.props.onItemsRendered === 'function') {\n      if (this.props.itemCount > 0) {\n        if (prevProps && prevProps.itemCount !== this.props.itemCount) {\n          for (let columnIndex = 0; columnIndex < this.itemMap.columns; columnIndex++) {\n            const [overscanStartIndex, overscanStopIndex] = this._getRangeToRender(columnIndex)\n            this._callOnItemsRendered(columnIndex, overscanStartIndex, overscanStopIndex)\n          }\n        }\n      }\n    }\n\n    if (typeof this.props.onScroll === 'function') {\n      if (!prevState ||\n        prevState.scrollDirection !== this.state.scrollDirection ||\n        prevState.scrollOffset !== this.state.scrollOffset ||\n        prevState.scrollUpdateWasRequested !== this.state.scrollUpdateWasRequested\n      ) {\n        this._callOnScroll(\n          this.state.scrollDirection,\n          this.state.scrollOffset,\n          this.state.scrollUpdateWasRequested,\n          this.preset.field\n        )\n      }\n    }\n\n    if (this.itemMap.isUnlimitedMode) {\n      setTimeout(() => {\n        for (let column = 0; column < this.itemMap.columns; column++) {\n          const [startIndex, stopIndex] = this._getRangeToRender(column)\n          for (let row = startIndex; row <= stopIndex; row++) {\n            const itemIndex = this.itemMap.getItemIndexByPosition(column, row)\n            if (itemIndex >= 0 && itemIndex < this.props.itemCount) {\n              const times = this.itemMap.compareSizeByPosition(column, row) ? 3 : 0\n              getRectSizeSync(`${this.props.queryPrefix}#${this.preset.id}-${itemIndex}`, 100, times).then(({ height }) => {\n                if (typeof height === 'number' && height > 0 && !this.itemMap.compareSizeByPosition(column, row, height)) {\n                  this.itemMap.setSizeByPosition(column, row, height)\n                }\n              })\n            }\n          }\n        }\n      }, 0)\n    }\n  }\n\n  // Lazily create and cache item styles while scrolling,\n  // So that pure component sCU will prevent re-renders.\n  // We maintain this cache, and pass a style prop rather than index,\n  // So that List can clear cached styles and force item re-render if necessary.\n  _getRangeToRender (columnIndex = 0) {\n    return this.itemMap.getRangeToRender(\n      this.state.scrollDirection,\n      columnIndex,\n      this.state.scrollOffset,\n      this.state.isScrolling,\n    )\n  }\n\n  _outerRefSetter = ref => {\n    const { outerRef } = this.props\n    this._outerRef = ref\n\n    if (typeof outerRef === 'function') {\n      outerRef(ref)\n    } else if (outerRef != null && typeof outerRef === 'object' && outerRef.hasOwnProperty('current')) {\n      // @ts-ignore\n      outerRef.current = ref\n    }\n  }\n\n  _resetIsScrollingDebounced = () => {\n    if (this._resetIsScrollingTimeoutId !== null) {\n      cancelTimeout(this._resetIsScrollingTimeoutId)\n    }\n\n    this._resetIsScrollingTimeoutId = requestTimeout(this._resetIsScrolling, IS_SCROLLING_DEBOUNCE_INTERVAL)\n  }\n\n  _resetIsScrolling = () => {\n    this._resetIsScrollingTimeoutId = null\n    this.setState({\n      isScrolling: false\n    }, () => {\n      // Clear style cache after state update has been committed.\n      // This way we don't break pure sCU for items that don't use isScrolling param.\n      this.preset.resetCache()\n    })\n  }\n\n  _onScroll = event => {\n    const {\n      scrollHeight = this.itemMap.maxColumnSize,\n      scrollWidth,\n      scrollTop,\n      scrollLeft\n    } = event.currentTarget\n    if (!isNumber(scrollHeight) || !isNumber(scrollWidth)) return\n    const clientHeight = this.itemMap.wrapperHeight\n    const clientWidth = this.itemMap.wrapperWidth\n    this.setState((prevState: IState) => {\n      const diffOffset = this.preset.field.scrollTop - scrollTop\n      if (prevState.scrollOffset === scrollTop || this.preset.isShaking(diffOffset)) {\n        // Scroll position may have been updated by cDM/cDU,\n        // In which case we don't need to trigger another render,\n        // And we don't want to update state.isScrolling.\n        return null\n      }\n      // FIXME preact 中使用时，该组件会出现触底滚动事件重复触发导致的抖动问题，后续修复\n      // Prevent Safari's elastic scrolling from causing visual shaking when scrolling past bounds.\n      const scrollOffset = Math.max(0, Math.min(scrollTop, scrollHeight - clientHeight))\n      this.preset.field = {\n        scrollHeight: this.itemMap.maxColumnSize,\n        scrollWidth,\n        scrollTop: scrollOffset,\n        scrollLeft,\n        clientHeight,\n        clientWidth,\n        diffOffset: this.preset.field.scrollTop - scrollOffset,\n      }\n      return {\n        isScrolling: true,\n        scrollDirection: prevState.scrollOffset < scrollOffset ? 'forward' : 'backward',\n        scrollOffset,\n        scrollUpdateWasRequested: false\n      }\n    }, this._resetIsScrollingDebounced)\n  }\n\n  public scrollTo (scrollOffset = 0, enhanced = this.preset.enhanced) {\n    scrollOffset = Math.max(0, scrollOffset)\n    if (this.state.scrollOffset === scrollOffset) return\n\n    if (enhanced) {\n      const option: any = {\n        animated: true,\n        duration: 300,\n      }\n      option.top = scrollOffset\n      return getScrollViewContextNode(`${this.props.queryPrefix}#${this.preset.id}`).then((node: any) => node.scrollTo(option))\n    }\n\n    this.setState((prevState: IState) => {\n      if (prevState.scrollOffset === scrollOffset) {\n        return null\n      }\n\n      return {\n        scrollDirection: prevState.scrollOffset < scrollOffset ? 'forward' : 'backward',\n        scrollOffset,\n        scrollUpdateWasRequested: true\n      }\n    }, this._resetIsScrollingDebounced)\n  }\n\n  public scrollToItem (index: number, align = 'auto', enhanced = this.preset.enhanced) {\n    const { itemCount } = this.props\n    const { scrollOffset } = this.state\n    index = Math.max(0, Math.min(index, itemCount - 1))\n    this.scrollTo(this.itemMap.getOffsetForIndexAndAlignment(index, align, scrollOffset), enhanced)\n  }\n\n  componentDidMount () {\n    const { initialScrollOffset } = this.props\n\n    if (typeof initialScrollOffset === 'number' && this._outerRef != null) {\n      this._outerRef.scrollTop = initialScrollOffset\n    }\n\n    this._callPropsCallbacks()\n    this.preset.boundaryDetection()\n  }\n\n  componentDidUpdate (prevProps: IProps, prevState: IState) {\n    const { scrollOffset, scrollUpdateWasRequested } = this.state\n\n    this.preset.update(this.props)\n\n    if (scrollUpdateWasRequested && this._outerRef != null) {\n      this._outerRef.scrollTop = scrollOffset\n    }\n\n    this._callPropsCallbacks(prevProps, prevState)\n  }\n\n  componentWillUnmount () {\n    if (this._resetIsScrollingTimeoutId !== null) {\n      cancelTimeout(this._resetIsScrollingTimeoutId)\n    }\n    this.preset.dispose()\n  }\n\n  getRenderItemNode (itemIndex: number, type: 'node' | 'placeholder' = 'node') {\n    const { item, itemData, itemKey = defaultItemKey, useIsScrolling } = this.props\n    const { isScrolling } = this.state\n    const key = itemKey(itemIndex, itemData)\n\n    const style = this.preset.getItemStyle(itemIndex)\n    if (type === 'placeholder') {\n      return React.createElement<any>(this.preset.itemElement, {\n        key,\n        id: `${this.preset.id}-${itemIndex}-wrapper`,\n        style: this.preset.isBrick ? style : { display: 'none' }\n      })\n    }\n\n    return React.createElement<any>(this.preset.itemElement, {\n      key,\n      id: `${this.preset.id}-${itemIndex}-wrapper`,\n      style\n    }, React.createElement(item, {\n      id: `${this.preset.id}-${itemIndex}`,\n      data: itemData,\n      index: itemIndex,\n      isScrolling: useIsScrolling ? isScrolling : undefined\n    }))\n  }\n\n  getRenderColumnNode (columnIndex: number) {\n    const columnProps: any = {\n      key: `${this.preset.id}-column-${columnIndex}`,\n      id: `${this.preset.id}-column-${columnIndex}`,\n      style: {\n        height: '100%',\n        position: 'relative',\n        width: convertNumber2PX(this.itemMap.columnWidth)\n      }\n    }\n\n    const [startIndex, stopIndex] = this._getRangeToRender(columnIndex)\n    const items = []\n    if (this.preset.isRelative && !this.preset.isBrick) {\n      const pre = convertNumber2PX(this.itemMap.getOffsetSizeCache(columnIndex, startIndex))\n      items.push(\n        React.createElement<any>(this.preset.itemElement, {\n          key: `${this.preset.id}-${columnIndex}-pre`,\n          id: `${this.preset.id}-${columnIndex}-pre`,\n          style: {\n            height: pre,\n            width: '100%'\n          }\n        })\n      )\n    }\n    const placeholderCount = this.preset.placeholderCount\n    const restCount = this.itemMap.getColumnLength(columnIndex) - stopIndex\n    const prevPlaceholder = startIndex < placeholderCount ? startIndex : placeholderCount\n    const postPlaceholder = restCount < placeholderCount ? restCount : placeholderCount\n    const visibleItem = (stopIndex + postPlaceholder) * this.itemMap.columns + columnIndex\n    this.itemMap.updateItem(visibleItem)\n    for (let row = 0; row < stopIndex + postPlaceholder; row++) {\n      const itemIndex = this.itemMap.getItemIndexByPosition(columnIndex, row)\n      if (itemIndex >= 0 && itemIndex < this.props.itemCount) {\n        if (!this.preset.isBrick) {\n          if (row < startIndex - prevPlaceholder) {\n            row = startIndex - prevPlaceholder\n            continue\n          }\n        }\n\n        if (row < startIndex || row > stopIndex) {\n          items.push(this.getRenderItemNode(itemIndex, 'placeholder'))\n        } else {\n          items.push(this.getRenderItemNode(itemIndex))\n        }\n      }\n    }\n    return React.createElement(this.preset.innerElement, columnProps, items)\n  }\n\n  render () {\n    const {\n      className,\n      style,\n      height,\n      width,\n      enhanced,\n      outerWrapper,\n      renderTop,\n      renderBottom,\n      ...rest\n    } = omit(this.props, [\n      'item', 'itemCount', 'itemData', 'itemKey', 'useIsScrolling',\n      'innerElementType', 'innerTagName', 'itemElementType', 'itemTagName',\n      'outerElementType', 'outerTagName', 'onScrollToLower', 'onScrollToUpper',\n      'upperThreshold', 'lowerThreshold',\n      'position',\n    ])\n    const {\n      isScrolling,\n      scrollOffset,\n      scrollUpdateWasRequested\n    } = this.state\n\n    const estimatedHeight = convertNumber2PX(this.itemMap.maxColumnSize)\n    const outerProps: any = {\n      ...rest,\n      id: this.preset.id,\n      className: classNames(className, 'virtual-waterfall'),\n      onScroll: this._onScroll,\n      ref: this._outerRefSetter,\n      style: {\n        height: convertNumber2PX(height),\n        width: convertNumber2PX(width),\n        overflow: 'auto',\n        WebkitOverflowScrolling: 'touch',\n        willChange: 'transform',\n        ...style\n      },\n      enhanced,\n      outerElementType: this.preset.outerElement,\n      innerElementType: this.preset.innerElement,\n      renderTop,\n      renderBottom,\n    }\n\n    if (!this.preset.enhanced) {\n      outerProps.scrollTop = scrollUpdateWasRequested ? scrollOffset : this.preset.field.scrollTop\n    }\n\n    const columnNodes: React.ReactNode[] = []\n    for (let i = 0; i < this.itemMap.columns; i++) {\n      columnNodes.push(this.getRenderColumnNode(i))\n    }\n\n    return React.createElement(\n      outerWrapper || this.preset.outerElement,\n      outerProps,\n      React.createElement(this.preset.innerElement, {\n        key: `${this.preset.id}-wrapper`,\n        id: `${this.preset.id}-wrapper`,\n        className: classNames(className, 'virtual-waterfall-wrapper'),\n        style: {\n          display: 'flex',\n          justifyContent: 'space-evenly',\n          pointerEvents: isScrolling ? 'none' : 'auto',\n          position: 'relative',\n          height: estimatedHeight,\n          width: '100%',\n          ...style\n        },\n      } as any, columnNodes),\n    )\n  }\n}\n"],"names":[],"mappings":"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"}