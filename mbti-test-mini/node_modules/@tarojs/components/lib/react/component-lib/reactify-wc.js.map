{"version":3,"file":"reactify-wc.js","sources":["../../../../taro-components-library-react/src/component-lib/reactify-wc.ts"],"sourcesContent":["/**\n * https://github.com/BBKolton/reactify-wc/\n * modified event naming\n **/\nimport React, { createElement, createRef } from 'react'\n\nconst h = React.createElement\n\nconst SCROLL_VIEW = 'taro-scroll-view-core'\n\nconst IS_NON_DIMENSIONAL = /aspect|acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i\n\n// 为了不要覆盖 wc 中 host 内置的 class 和 stencil 加入的 class\nfunction getClassName (wc, prevProps, props) {\n  const classList = Array.from(wc.classList)\n  const oldClassNames = (prevProps.className || prevProps.class || '').split(' ')\n  let incomingClassNames = (props.className || props.class || '').split(' ')\n  let finalClassNames = []\n\n  classList.forEach(classname => {\n    if (incomingClassNames.indexOf(classname) > -1) {\n      finalClassNames.push(classname)\n      incomingClassNames = incomingClassNames.filter(name => name !== classname)\n    } else if (oldClassNames.indexOf(classname) === -1) {\n      finalClassNames.push(classname)\n    }\n  })\n\n  finalClassNames = [...finalClassNames, ...incomingClassNames]\n\n  return finalClassNames.join(' ')\n}\n\nfunction updateStyle (dom, key, val) {\n  if (/^--/.test(key)) {\n    // css variable\n    dom.style.setProperty(key, val)\n  } else if (typeof val !== 'number' || IS_NON_DIMENSIONAL.test(key)) {\n    dom.style[key] = val\n  } else {\n    dom.style[key] = val + 'px'\n  }\n}\n\nfunction updateProp (ctx, comp, propKey, prevProps, props) {\n  const dom = ctx.ref.current\n  const val = props[propKey]\n  const prevVal = prevProps ? prevProps[propKey] : undefined\n\n  if (propKey === 'children') {\n    return\n  }\n  if (propKey.toLowerCase() === 'classname') {\n    dom.className = prevProps\n      ? getClassName(dom, prevProps, props)\n      : val\n    return\n  }\n  if (propKey === 'style') {\n    if (typeof val === 'string') {\n      dom.setAttribute(propKey, val)\n      return\n    }\n    if (!val) {\n      dom.removeAttribute(propKey)\n      return\n    }\n\n    if (prevProps) {\n      if (typeof prevVal === 'string') {\n        dom.style.cssText = ''\n      } else {\n        for (const styleKey in prevVal) {\n          updateStyle(dom, styleKey, '')\n        }\n      }\n    }\n\n    for (const styleKey in val) {\n      updateStyle(dom, styleKey, val[styleKey])\n    }\n    return\n  }\n  if (/^(aria|data)-.+/.test(propKey)) {\n    dom.setAttribute(propKey, val)\n  }\n  if (comp === SCROLL_VIEW) {\n    if (propKey === 'scrollTop') {\n      dom.mpScrollTop = val\n      return\n    }\n    if (propKey === 'scrollLeft') {\n      dom.mpScrollLeft = val\n      return\n    }\n    if (propKey === 'scrollIntoView') {\n      dom.mpScrollIntoView = val\n      return\n    }\n  }\n  if (typeof val === 'function' && propKey.match(/^on[A-Z]/)) {\n    const event = propKey.substr(2).toLowerCase()\n\n    ctx.eventHandlers.push([event, val])\n    return dom.addEventListener(event, val)\n  }\n\n  if (typeof val === 'string' || typeof val === 'number') {\n    dom.setAttribute(propKey, val)\n    dom[propKey] = val\n    return\n  }\n  if (typeof val === 'boolean') {\n    if (val) {\n      dom[propKey] = true\n      return dom.setAttribute(\n        propKey,\n        val\n      )\n    }\n    dom[propKey] = false\n    return dom.removeAttribute(propKey)\n  }\n  dom[propKey] = val\n}\n\nconst reactifyWebComponent = WC => {\n  class Index extends React.Component<Record<string, any>> {\n    eventHandlers: any[]\n    ref: React.RefObject<HTMLElement>\n\n    constructor (props) {\n      super(props)\n      this.eventHandlers = []\n      this.ref = createRef()\n    }\n\n    update (prevProps) {\n      this.clearEventHandlers()\n      if (!this.ref.current) return\n\n      Object.keys(prevProps || {}).forEach((key) => {\n        if (key !== 'children' && key !== 'key' && !(key in this.props)) {\n          updateProp(this, WC, key, prevProps, this.props)\n        }\n      })\n\n      Object.keys(this.props).forEach((key) => {\n        updateProp(this, WC, key, prevProps, this.props)\n      })\n    }\n\n    componentDidUpdate (prevProps) {\n      this.update(prevProps)\n    }\n\n    componentDidMount () {\n      const { forwardRef } = this.props\n      if (typeof forwardRef === 'function') {\n        forwardRef(this.ref.current)\n      } else if (forwardRef && typeof forwardRef === 'object' && forwardRef.hasOwnProperty('current')) {\n        forwardRef.current = this.ref.current\n      } else if (typeof forwardRef === 'string') {\n        console.warn('内置组件不支持字符串 ref')\n      }\n      this.update(undefined)\n    }\n\n    componentWillUnmount () {\n      this.clearEventHandlers()\n    }\n\n    clearEventHandlers () {\n      this.eventHandlers.forEach(([event, handler]) => {\n        if (!this.ref.current) return\n        this.ref.current.removeEventListener(event, handler)\n      })\n      this.eventHandlers = []\n    }\n\n    render () {\n      const { children, dangerouslySetInnerHTML } = this.props\n      const props: Record<string, any> = {\n        ref: this.ref\n      }\n      if (dangerouslySetInnerHTML) props.dangerouslySetInnerHTML = dangerouslySetInnerHTML\n      return createElement(WC, props, children)\n    }\n  }\n\n  // eslint-disable-next-line react/display-name\n  return React.forwardRef((props, ref) => (\n    h(Index, { ...props, forwardRef: ref })\n  ))\n}\n\nexport default reactifyWebComponent\n"],"names":[],"mappings":"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"}