{"version":3,"file":"createComponent.js","sources":["../../../../taro-components-library-react/src/react-component-lib/createComponent.tsx"],"sourcesContent":["/**\n * Modify from https://github.com/ionic-team/stencil-ds-output-targets/blob/main/packages/react-output-target/react-component-lib/createComponent.ts\n * MIT License https://github.com/ionic-team/stencil-ds-output-targets/blob/main/LICENSE\n */\nimport React, { createElement } from 'react'\n\nimport {\n  applyUnControlledDefaultValue,\n  attachProps,\n  camelToDashCase,\n  createForwardRef,\n  dashToPascalCase,\n  isCoveredByReact,\n  mergeRefs,\n} from './utils'\n\nexport interface HTMLStencilElement extends HTMLElement {\n  componentOnReady(): Promise<this>\n}\n\ninterface StencilReactInternalProps<ElementType> extends React.HTMLAttributes<ElementType> {\n  forwardedRef: React.RefObject<ElementType>\n  ref?: React.Ref<any>\n}\n\nexport const createReactComponent = <\n  PropType,\n  ElementType extends HTMLStencilElement,\n  ContextStateType = any,\n  ExpandedPropsTypes = any\n>(\n  tagName: string,\n  ReactComponentContext?: React.Context<ContextStateType>,\n  manipulatePropsFunction?: (\n    originalProps: StencilReactInternalProps<ElementType>,\n    propsToPass: any\n  ) => ExpandedPropsTypes,\n  defineCustomElement?: () => void\n) => {\n  if (!DEPRECATED_ADAPTER_COMPONENT && defineCustomElement !== undefined) {\n    defineCustomElement()\n  }\n\n  const displayName = dashToPascalCase(tagName)\n  const ReactComponent = class extends React.Component<StencilReactInternalProps<ElementType>> {\n    componentEl!: ElementType\n\n    setComponentElRef = (element: ElementType) => {\n      this.componentEl = element\n    }\n\n    // eslint-disable-next-line no-useless-constructor\n    constructor (props: StencilReactInternalProps<ElementType>) {\n      super(props)\n    }\n\n    componentDidMount () {\n      applyUnControlledDefaultValue(this.componentEl, this.props)\n      this.componentDidUpdate(this.props)\n    }\n\n    componentDidUpdate (prevProps: StencilReactInternalProps<ElementType>) {\n      attachProps(this.componentEl, this.props, prevProps)\n    }\n\n    render () {\n      // eslint-disable-next-line @typescript-eslint/no-unused-vars\n      const { children, forwardedRef, className, ref, style, ...cProps } = this.props\n\n      let propsToPass = Object.keys(cProps).reduce((acc: any, name) => {\n        const value = (cProps as any)[name]\n\n        if (name.indexOf('on') === 0 && name[2] === name[2].toUpperCase()) {\n          const eventName = name.substring(2).toLowerCase()\n          if (typeof document !== 'undefined' && isCoveredByReact(eventName)) {\n            acc[name] = value\n          }\n        } else {\n          // we should only render strings, booleans, and numbers as attrs in html.\n          // objects, functions, arrays etc get synced via properties on mount.\n          const type = typeof value\n\n          if (['string', 'boolean', 'number'].includes(type)) {\n            acc[camelToDashCase(name)] = value\n          }\n        }\n        return acc\n      }, {} as ExpandedPropsTypes)\n\n      if (manipulatePropsFunction) {\n        propsToPass = manipulatePropsFunction(this.props, propsToPass)\n      }\n\n      const newProps: Omit<StencilReactInternalProps<ElementType>, 'forwardedRef'> = {\n        ...propsToPass,\n        ref: mergeRefs(forwardedRef, this.setComponentElRef),\n        // Note(taro): 需处理 string 类型的 style，调整到 manipulatePropsFunction 方法中判断是否需注入 (string 类型在 attachProps 中处理)\n        // style\n      }\n\n      /**\n       * We use createElement here instead of\n       * React.createElement to work around a\n       * bug in Vite (https://github.com/vitejs/vite/issues/6104).\n       * React.createElement causes all elements to be rendered\n       * as <tagname> instead of the actual Web Component.\n       */\n      return createElement(tagName, newProps, children)\n    }\n\n    static get displayName () {\n      return displayName\n    }\n  }\n\n  // If context was passed to createReactComponent then conditionally add it to the Component Class\n  if (ReactComponentContext) {\n    ReactComponent.contextType = ReactComponentContext\n  }\n\n  return createForwardRef<PropType, ElementType>(ReactComponent, displayName)\n}\n"],"names":[],"mappings":"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"}