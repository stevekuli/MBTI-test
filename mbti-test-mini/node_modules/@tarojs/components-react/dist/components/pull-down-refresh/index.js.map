{"version":3,"file":"index.js","sources":["../../../src/components/pull-down-refresh/index.tsx"],"sourcesContent":["import './style/index.css'\r\n\r\nimport Taro from '@tarojs/taro'\r\nimport classNames from 'classnames'\r\nimport React from 'react'\r\n\r\nfunction setTransform (nodeStyle, value) {\r\n  nodeStyle.transform = value\r\n  nodeStyle.webkitTransform = value\r\n  nodeStyle.MozTransform = value\r\n}\r\n\r\nconst isWebView =\r\n  typeof navigator !== 'undefined' && /(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(navigator.userAgent)\r\n\r\nenum PullDownState {\r\n  activate = 'activate',\r\n  deactivate = 'deactivate',\r\n  release = 'release',\r\n  finish = 'finish'\r\n}\r\n\r\nenum INDICATOR {\r\n  activate = 'release',\r\n  deactivate = 'pull',\r\n  release = 'loading',\r\n  finish = 'finish'\r\n}\r\n\r\nlet supportsPassive = false\r\ntry {\r\n  const opts = Object.defineProperty({}, 'passive', {\r\n    get () {\r\n      supportsPassive = true\r\n    }\r\n  })\r\n  window.addEventListener('cancel', () => ({}), opts)\r\n} catch (e) {} // eslint-disable-line no-empty\r\n\r\nconst willPreventDefault = supportsPassive ? { passive: false } : false\r\n\r\ninterface IProps extends React.HTMLAttributes<HTMLBaseElement> {\r\n  prefixCls: string\r\n  distanceToRefresh: number\r\n  damping: number\r\n  indicator: INDICATOR\r\n  onRefresh?: () => void\r\n}\r\n\r\ninterface IState {\r\n  currSt: PullDownState\r\n  dragOnEdge: boolean\r\n}\r\n\r\nclass PullDownRefresh extends React.Component<IProps, IState> {\r\n  static defaultProps = {\r\n    prefixCls: 'rmc-pull-to-refresh',\r\n    distanceToRefresh: 50,\r\n    damping: 100,\r\n    indicator: INDICATOR\r\n  }\r\n\r\n  // https://github.com/yiminghe/zscroller/blob/2d97973287135745818a0537712235a39a6a62a1/src/Scroller.js#L355\r\n  // currSt: `activate` / `deactivate` / `release` / `finish`\r\n  state = {\r\n    currSt: PullDownState.deactivate,\r\n    dragOnEdge: false\r\n  }\r\n\r\n  containerRef: HTMLElement | null\r\n  contentRef: HTMLDivElement | null\r\n  _to: Record<string, EventListener>\r\n  _ScreenY = 0\r\n  _startScreenY = 0\r\n  _lastScreenY = 0\r\n  _isMounted = false\r\n  listeners: [string, (...args: any[]) => void][] = []\r\n\r\n  get scrollContainer () {\r\n    return (\r\n      this.contentRef?.parentElement ||\r\n      this.contentRef?.closest('.taro_page_stationed') ||\r\n      document.querySelector('.taro_page_stationed') ||\r\n      document.querySelector('.taro_page') ||\r\n      document.querySelector('.taro_router') ||\r\n      document.querySelector('.taro-tabbar__panel') ||\r\n      document.body\r\n    )\r\n  }\r\n\r\n  componentDidMount () {\r\n    this.init()\r\n    this._isMounted = true\r\n    this.listeners = [\r\n      [\r\n        '__taroStartPullDownRefresh',\r\n        ({ successHandler, errorHandler }) => {\r\n          try {\r\n            this.triggerPullDownRefresh(true)\r\n            successHandler({\r\n              errMsg: 'startPullDownRefresh: ok'\r\n            })\r\n          } catch (e) {\r\n            errorHandler({\r\n              errMsg: 'startPullDownRefresh: fail'\r\n            })\r\n          }\r\n        }\r\n      ],\r\n      [\r\n        '__taroStopPullDownRefresh',\r\n        ({ successHandler, errorHandler }) => {\r\n          try {\r\n            this.triggerPullDownRefresh(false)\r\n            successHandler({\r\n              errMsg: 'stopPullDownRefresh: ok'\r\n            })\r\n          } catch (e) {\r\n            errorHandler({\r\n              errMsg: 'stopPullDownRefresh: fail'\r\n            })\r\n          }\r\n        }\r\n      ]\r\n    ]\r\n    this.listeners.forEach(([evtName, callback]) => {\r\n      Taro.eventCenter.on(evtName, callback)\r\n    })\r\n  }\r\n\r\n  componentWillUnmount () {\r\n    this.destroy()\r\n    this.listeners.forEach(([evtName, callback]) => {\r\n      Taro.eventCenter.off(evtName, callback)\r\n    })\r\n  }\r\n\r\n  componentDidUpdate (_, prevState: IState) {\r\n    if (prevState.currSt !== this.state.currSt) {\r\n      const pageEl: any = this.scrollContainer\r\n      switch (this.state.currSt) {\r\n        case PullDownState.release:\r\n          pageEl?.__page?.onPullDownRefresh?.()\r\n          break\r\n        case PullDownState.deactivate:\r\n          pageEl?.__page?.onPullIntercept?.()\r\n      }\r\n    }\r\n  }\r\n\r\n  triggerPullDownRefresh = (flag: boolean) => {\r\n    // 在初始化时、用代码 自动 触发 pullDownRefresh\r\n    // 添加this._isMounted的判断，否则组建一实例化，currSt就会是finish\r\n    if (!this.state.dragOnEdge && this._isMounted) {\r\n      if (flag) {\r\n        this._lastScreenY = this.props.distanceToRefresh + 1\r\n        // change dom need after setState\r\n        this.setState({ currSt: PullDownState.release }, () => this.setContentStyle(this._lastScreenY))\r\n      } else {\r\n        this.setState({ currSt: PullDownState.finish }, () => this.reset())\r\n      }\r\n    }\r\n  }\r\n\r\n  init = () => {\r\n    const ele = this.scrollContainer\r\n    this._to = {\r\n      touchstart: this.onTouchStart.bind(this, ele),\r\n      touchmove: this.onTouchMove.bind(this, ele),\r\n      touchend: this.onTouchEnd.bind(this, ele),\r\n      touchcancel: this.onTouchEnd.bind(this, ele)\r\n    }\r\n    Object.keys(this._to).forEach(key => {\r\n      ele.addEventListener(key, this._to[key], willPreventDefault)\r\n    })\r\n  }\r\n\r\n  destroy = () => {\r\n    if (!this._to) return\r\n\r\n    const ele = this.scrollContainer\r\n    Object.keys(this._to).forEach(key => {\r\n      ele.removeEventListener(key, this._to[key])\r\n    })\r\n  }\r\n\r\n  onTouchStart = (_, e: TouchEvent) => {\r\n    this._ScreenY = this._startScreenY = e.touches[0].screenY\r\n    // 一开始 refreshing 为 true 时 this._lastScreenY 有值\r\n    this._lastScreenY = this._lastScreenY || 0\r\n  }\r\n\r\n  isEdge = (ele: HTMLElement) => {\r\n    const container = this.scrollContainer\r\n    if (container && container === document.body) {\r\n      // In chrome61 `document.body.scrollTop` is invalid\r\n      const scrollNode = document.scrollingElement ? document.scrollingElement : document.body\r\n      return scrollNode.scrollTop <= 0\r\n    }\r\n    return ele.scrollTop <= 0\r\n  }\r\n\r\n  damping = (dy: number) => {\r\n    if (Math.abs(this._lastScreenY) > this.props.damping) {\r\n      return 0\r\n    }\r\n\r\n    const ratio = Math.abs(this._ScreenY - this._startScreenY) / window.screen.height\r\n    dy *= (1 - ratio) * 0.6\r\n\r\n    return dy\r\n  }\r\n\r\n  onTouchMove = (ele: HTMLElement, e: TouchEvent) => {\r\n    // 使用 pageY 对比有问题\r\n    const _screenY = e.touches[0].screenY\r\n\r\n    // 拖动方向不符合的不处理\r\n    if (this._startScreenY > _screenY) {\r\n      return\r\n    }\r\n\r\n    if (this.isEdge(ele)) {\r\n      if (!this.state.dragOnEdge) {\r\n        // 当用户开始往上滑的时候isEdge还是false的话，会导致this._ScreenY不是想要的，只有当isEdge为true时，再上滑，才有意义\r\n        // 下面这行代码解决了上面这个问题\r\n        this._ScreenY = this._startScreenY = e.touches[0].screenY\r\n        this.setState({ dragOnEdge: true })\r\n      }\r\n      if (e.cancelable) {\r\n        e.preventDefault()\r\n      }\r\n      // add stopPropagation with fastclick will trigger content onClick event. why?\r\n      // ref https://github.com/ant-design/ant-design-mobile/issues/2141\r\n      // e.stopPropagation();\r\n\r\n      const _diff = Math.round(_screenY - this._ScreenY)\r\n      this._ScreenY = _screenY\r\n      this._lastScreenY += this.damping(_diff)\r\n\r\n      this.setContentStyle(this._lastScreenY)\r\n\r\n      if (Math.abs(this._lastScreenY) < this.props.distanceToRefresh) {\r\n        if (this.state.currSt !== PullDownState.deactivate) {\r\n          // console.log('back to the distance');\r\n          this.setState({ currSt: PullDownState.deactivate })\r\n        }\r\n      } else {\r\n        if (this.state.currSt === PullDownState.deactivate) {\r\n          // console.log('reach to the distance');\r\n          this.setState({ currSt: PullDownState.activate })\r\n        }\r\n      }\r\n\r\n      // https://github.com/ant-design/ant-design-mobile/issues/573#issuecomment-339560829\r\n      // iOS UIWebView issue, It seems no problem in WKWebView\r\n      if (isWebView && e.changedTouches[0].clientY < 0) {\r\n        this.onTouchEnd()\r\n      }\r\n    }\r\n  }\r\n\r\n  onTouchEnd = () => {\r\n    if (this.state.dragOnEdge) {\r\n      this.setState({ dragOnEdge: false })\r\n    }\r\n    if (this.state.currSt === PullDownState.activate) {\r\n      this.setState({ currSt: PullDownState.release })\r\n      this.props.onRefresh?.()\r\n      this._lastScreenY = this.props.distanceToRefresh + 1\r\n      this.setContentStyle(this._lastScreenY)\r\n    } else if (this.state.currSt === 'release') {\r\n      this._lastScreenY = this.props.distanceToRefresh + 1\r\n      this.setContentStyle(this._lastScreenY)\r\n    } else {\r\n      this.reset()\r\n    }\r\n  }\r\n\r\n  reset = () => {\r\n    this._lastScreenY = 0\r\n    this.setContentStyle(0)\r\n  }\r\n\r\n  setContentStyle = ty => {\r\n    // TODO: Why sometimes do not have `this.contentRef` ?\r\n    if (this.contentRef) {\r\n      // translate3d 不清理 会影响内部元素定位\r\n      if (ty) {\r\n        setTransform(this.contentRef.style, `translate3d(0px,${ty}px,0)`)\r\n      } else {\r\n        setTransform(this.contentRef.style, '')\r\n      }\r\n    }\r\n  }\r\n\r\n  render () {\r\n    const props: Partial<IProps> & {\r\n      children?: React.ReactNode\r\n    } = { ...this.props }\r\n    delete props.damping\r\n    delete props.indicator\r\n    delete props.distanceToRefresh\r\n    delete props.onRefresh\r\n\r\n    const { className, prefixCls, children, ...restProps } = props\r\n\r\n    const renderRefresh = (cls: string) => {\r\n      const { currSt, dragOnEdge } = this.state\r\n      const cla = classNames(cls, !dragOnEdge && `${prefixCls}-transition`)\r\n      const showIndicator = currSt === 'activate' || currSt === 'release'\r\n      return (\r\n        <div className={`${prefixCls}-content-wrapper`}>\r\n          <div\r\n            className={cla}\r\n            ref={el => {\r\n              this.contentRef = el\r\n            }}\r\n          >\r\n            {showIndicator && (\r\n              <div className={`${prefixCls}-indicator`}>\r\n                <div />\r\n                <div />\r\n                <div />\r\n              </div>\r\n            )}\r\n            {children}\r\n          </div>\r\n        </div>\r\n      )\r\n    }\r\n\r\n    if (this.scrollContainer) {\r\n      return renderRefresh(`${prefixCls}-content ${prefixCls}-down`)\r\n    }\r\n    return (\r\n      <pull-down-refresh\r\n        ref={el => {\r\n          this.containerRef = el\r\n        }}\r\n        className={classNames(className, prefixCls, `${prefixCls}-down`)}\r\n        {...restProps}\r\n      >\r\n        {renderRefresh(`${prefixCls}-content`)}\r\n      </pull-down-refresh>\r\n    )\r\n  }\r\n}\r\n\r\nexport default PullDownRefresh\r\n"],"names":["setTransform","nodeStyle","value","transform","webkitTransform","MozTransform","isWebView","navigator","test","userAgent","PullDownState","INDICATOR","supportsPassive","opts","Object","defineProperty","get","window","addEventListener","e","willPreventDefault","passive","PullDownRefresh","_React$Component","_inherits","_super","_createSuper","_this","_classCallCheck","state","currSt","deactivate","dragOnEdge","_ScreenY","_startScreenY","_lastScreenY","_isMounted","listeners","triggerPullDownRefresh","flag","props","distanceToRefresh","setState","release","setContentStyle","finish","reset","init","ele","scrollContainer","_to","touchstart","onTouchStart","bind","_assertThisInitialized","touchmove","onTouchMove","touchend","onTouchEnd","touchcancel","keys","forEach","key","destroy","removeEventListener","_","touches","screenY","isEdge","container","document","body","scrollNode","scrollingElement","scrollTop","damping","dy","Math","abs","ratio","screen","height","_screenY","cancelable","preventDefault","_diff","round","activate","changedTouches","clientY","_b","onRefresh","ty","contentRef","style","concat","_createClass","_a","parentElement","closest","querySelector","componentDidMount","_this2","_ref","successHandler","errorHandler","errMsg","_ref2","_ref3","_ref4","_slicedToArray","evtName","callback","Taro","eventCenter","on","componentWillUnmount","_ref5","_ref6","off","componentDidUpdate","prevState","pageEl","__page","onPullDownRefresh","call","_d","_c","onPullIntercept","render","_this3","assign","indicator","className","prefixCls","children","restProps","__rest","renderRefresh","cls","_this3$state","cla","classNames","showIndicator","React","createElement","ref","el","containerRef","Component","defaultProps"],"mappings":"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"}