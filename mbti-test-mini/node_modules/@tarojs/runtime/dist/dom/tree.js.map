{"version":3,"file":"tree.js","sources":["../../src/dom/tree.ts"],"sourcesContent":["import { NodeType } from './node_types'\n\nimport type { TaroElement } from './element'\n\ntype Filter = (element: TaroElement) => boolean\n\nfunction returnTrue () {\n  return true\n}\n\nexport function treeToArray (root: TaroElement, predict?: Filter): TaroElement[] {\n  const array: TaroElement[] = []\n  const filter = predict ?? returnTrue\n\n  let object: TaroElement | null = root\n\n  while (object) {\n    if (object.nodeType === NodeType.ELEMENT_NODE && filter(object)) {\n      array.push(object)\n    }\n\n    object = following(object, root)\n  }\n\n  return array\n}\n\nfunction following (el: TaroElement, root: TaroElement): TaroElement | null {\n  const firstChild = el.firstChild\n  const isElmentTypeValid = el.nodeType === NodeType.ELEMENT_NODE || el.nodeType === NodeType.DOCUMENT_NODE\n\n  // 如果当前 el 不是 element 或 document 元素，则可以直接不递归他的子元素了\n  if (firstChild && isElmentTypeValid) {\n    return firstChild as TaroElement\n  }\n\n  let current: TaroElement | null = el\n\n  do {\n    if (current === root) {\n      return null\n    }\n\n    const nextSibling = current.nextSibling\n\n    if (nextSibling) {\n      return nextSibling as TaroElement\n    }\n    current = current.parentElement\n  } while (current)\n\n  return null\n}\n"],"names":[],"mappings":"AAMA,SAAS,UAAU,GAAA;AACjB,IAAA,OAAO,IAAI,CAAA;AACb,CAAC;AAEe,SAAA,WAAW,CAAE,IAAiB,EAAE,OAAgB,EAAA;IAC9D,MAAM,KAAK,GAAkB,EAAE,CAAA;IAC/B,MAAM,MAAM,GAAG,OAAO,KAAA,IAAA,IAAP,OAAO,KAAP,KAAA,CAAA,GAAA,OAAO,GAAI,UAAU,CAAA;IAEpC,IAAI,MAAM,GAAuB,IAAI,CAAA;AAErC,IAAA,OAAO,MAAM,EAAE;QACb,IAAI,MAAM,CAAC,QAAQ,KAAA,CAAA,gCAA8B,MAAM,CAAC,MAAM,CAAC,EAAE;AAC/D,YAAA,KAAK,CAAC,IAAI,CAAC,MAAM,CAAC,CAAA;AACnB,SAAA;AAED,QAAA,MAAM,GAAG,SAAS,CAAC,MAAM,EAAE,IAAI,CAAC,CAAA;AACjC,KAAA;AAED,IAAA,OAAO,KAAK,CAAA;AACd,CAAC;AAED,SAAS,SAAS,CAAE,EAAe,EAAE,IAAiB,EAAA;AACpD,IAAA,MAAM,UAAU,GAAG,EAAE,CAAC,UAAU,CAAA;IAChC,MAAM,iBAAiB,GAAG,EAAE,CAAC,QAAQ,KAA0B,CAAA,gCAAI,EAAE,CAAC,QAAQ,KAAA,CAAA,8BAA2B;;IAGzG,IAAI,UAAU,IAAI,iBAAiB,EAAE;AACnC,QAAA,OAAO,UAAyB,CAAA;AACjC,KAAA;IAED,IAAI,OAAO,GAAuB,EAAE,CAAA;IAEpC,GAAG;QACD,IAAI,OAAO,KAAK,IAAI,EAAE;AACpB,YAAA,OAAO,IAAI,CAAA;AACZ,SAAA;AAED,QAAA,MAAM,WAAW,GAAG,OAAO,CAAC,WAAW,CAAA;AAEvC,QAAA,IAAI,WAAW,EAAE;AACf,YAAA,OAAO,WAA0B,CAAA;AAClC,SAAA;AACD,QAAA,OAAO,GAAG,OAAO,CAAC,aAAa,CAAA;AAChC,KAAA,QAAQ,OAAO,EAAC;AAEjB,IAAA,OAAO,IAAI,CAAA;AACb;;;;"}