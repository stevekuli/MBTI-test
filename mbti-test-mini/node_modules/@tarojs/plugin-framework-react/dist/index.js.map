{"version":3,"file":"index.js","sources":["../src/loader-meta.ts","../src/webpack.h5.ts","../src/webpack.mini.ts","../src/index.ts"],"sourcesContent":["import * as acorn from 'acorn'\nimport * as walk from 'acorn-walk'\n\nimport { Frameworks } from './index'\n\ninterface ILoaderMeta {\n  importFrameworkStatement: string\n  mockAppStatement: string\n  frameworkArgs: string\n  creator: string\n  creatorLocation: string\n  extraImportForWeb: string\n  execBeforeCreateWebApp: string\n  importFrameworkName: string\n  isNeedRawLoader?: boolean\n  modifyConfig?: (config: Record<string, any>, source: string) => void\n}\n\nfunction addConfig (source) {\n  const configsMap = {\n    enableShareAppMessage: ['onShareAppMessage', 'useShareAppMessage'],\n    enableShareTimeline: ['onShareTimeline', 'useShareTimeline']\n  }\n  const ast = acorn.parse(source, {\n    ecmaVersion: 'latest',\n    sourceType: 'module'\n  })\n\n  const additionConfig: Record<string, any> = {}\n\n  function check (name: string) {\n    Object.keys(configsMap).forEach(configName => {\n      const apis: string[] = configsMap[configName]\n      if (apis.includes(name)) {\n        additionConfig[configName] = true\n      }\n    })\n  }\n\n  walk.simple(ast, {\n    FunctionExpression (node: any) {\n      if (!node.id || !node.id.name) return\n      check(node.id.name)\n    },\n    FunctionDeclaration (node: any) {\n      if (!node.id || !node.id.name) return\n      check(node.id.name)\n    },\n    CallExpression (node: any) {\n      const { callee } = node\n      if (callee.type === 'Identifier') {\n        check(callee.name)\n      } else if (callee.type === 'MemberExpression') {\n        if (callee.property.type === 'Identifier') {\n          check(callee.property.name)\n        } else if (callee.property.type === 'Literal') {\n          check(callee.property.value)\n        }\n      }\n      node.arguments.forEach(item => {\n        if (item.type === 'Literal' && item.value) {\n          check(item.value)\n        }\n      })\n    }\n  })\n\n  return additionConfig\n}\n\nconst nervMeta = {\n  importFrameworkStatement: `\nimport Nerv from 'nervjs';\n`,\n  mockAppStatement: `\nclass App extends Nerv.Component {\nrender () {\n  return this.props.children\n}\n}\n`,\n  frameworkArgs: 'Nerv, Nerv, config',\n  importFrameworkName: 'Nerv'\n}\n\nexport function getLoaderMeta (framework: Frameworks): ILoaderMeta {\n  const loaderMeta = {\n    importFrameworkStatement: `\nimport * as React from 'react'\nimport ReactDOM from 'react-dom'\n`,\n    mockAppStatement: `\nclass App extends React.Component {\n  render () {\n    return this.props.children\n  }\n}\n`,\n    frameworkArgs: 'React, ReactDOM, config',\n    creator: 'createReactApp',\n    creatorLocation: '@tarojs/plugin-framework-react/dist/runtime',\n    importFrameworkName: 'React',\n    extraImportForWeb: '',\n    execBeforeCreateWebApp: '',\n    modifyConfig (config, source) {\n      Object.assign(config, addConfig(source))\n    }\n  }\n  if (framework === 'nerv') {\n    Object.assign(loaderMeta, nervMeta)\n  }\n\n  if (process.env.TARO_PLATFORM === 'web') {\n    if (framework === 'react') {\n      const react = require('react')\n      const majorVersion = Number((react.version || '18').split('.')[0])\n      if (majorVersion >= 18) {\n        // Note: In react 18 or above, should using react-dom/client\n        loaderMeta.importFrameworkStatement = loaderMeta.importFrameworkStatement.replace('\\'react-dom\\'', '\\'react-dom/client\\'')\n        loaderMeta.extraImportForWeb += `import { findDOMNode, render, unstable_batchedUpdates } from 'react-dom'\\n`\n        loaderMeta.execBeforeCreateWebApp += `Object.assign(ReactDOM, { findDOMNode, render, unstable_batchedUpdates })\\n`\n      }\n    }\n  }\n  return loaderMeta\n}\n","import { mergeWith } from 'lodash'\n\nimport { getLoaderMeta } from './loader-meta'\n\nimport type { IPluginContext } from '@tarojs/service'\nimport type Chain from 'webpack-chain'\nimport type { Frameworks } from './index'\n\nexport function modifyH5WebpackChain (ctx: IPluginContext, framework: Frameworks, chain: Chain) {\n  setLoader(framework, chain)\n  setPlugin(ctx, framework, chain)\n\n  const { isBuildNativeComp = false } = ctx.runOpts?.options || {}\n  const externals: Record<string, { [externalType: string]: string } | string> = {}\n  if (isBuildNativeComp) {\n    // Note: 该模式不支持 prebundle 优化，不必再处理\n    externals.react = {\n      commonjs: 'react',\n      commonjs2: 'react',\n      amd: 'react',\n      root: 'React'\n    }\n    externals['react-dom'] = {\n      commonjs: 'react-dom',\n      commonjs2: 'react-dom',\n      amd: 'react-dom',\n      root: 'ReactDOM'\n    }\n    if (framework === 'preact') {\n      externals.preact = 'preact'\n    }\n\n    chain.merge({\n      externalsType: 'umd'\n    })\n  }\n\n  chain.merge({\n    externals,\n    module: {\n      rule: {\n        'process-import-taro-h5': {\n          test: /taro-h5[\\\\/]dist[\\\\/]api[\\\\/]taro/,\n          loader: require.resolve('./api-loader')\n        }\n      }\n    },\n  })\n}\n\nfunction setLoader (framework: Frameworks, chain) {\n  function customizer (object = '', sources = '') {\n    if ([object, sources].every(e => typeof e === 'string')) return object + sources\n  }\n  chain.plugin('mainPlugin')\n    .tap(args => {\n      args[0].loaderMeta = mergeWith(\n        getLoaderMeta(framework), args[0].loaderMeta, customizer\n      )\n      return args\n    })\n}\n\nfunction setPlugin (ctx: IPluginContext, framework: Frameworks, chain) {\n  const config = ctx.initialConfig\n  const webpackConfig = chain.toConfig()\n  const isProd = webpackConfig.mode === 'production'\n  if (!isProd && config.h5?.devServer?.hot !== false) {\n    // 默认开启 fast-refresh\n    if (framework === 'react') {\n      chain\n        .plugin('fastRefreshPlugin')\n        .use(require('@pmmmwh/react-refresh-webpack-plugin'))\n    } else if (framework === 'preact') {\n      chain\n        .plugin('hotModuleReplacementPlugin')\n        .use(require('webpack').HotModuleReplacementPlugin)\n      chain\n        .plugin('fastRefreshPlugin')\n        .use(require('@prefresh/webpack'))\n    }\n  }\n}\n","import { fs } from '@tarojs/helper'\nimport path from 'path'\n\nimport { getLoaderMeta } from './loader-meta'\n\nimport type { IPluginContext } from '@tarojs/service'\nimport type { Frameworks } from './index'\n\nexport function modifyMiniWebpackChain (ctx: IPluginContext, framework: Frameworks, chain) {\n  setAlias(ctx, framework, chain)\n  setLoader(framework, chain)\n}\n\nfunction setAlias (ctx: IPluginContext, framework: Frameworks, chain) {\n  const config = ctx.initialConfig\n  const alias = chain.resolve.alias\n\n  if (framework === 'react') {\n    alias.set('react-dom$', '@tarojs/react')\n    alias.set('react-dom/client$', '@tarojs/react')\n    const webpackConfig = chain.toConfig()\n    const isProd = webpackConfig.mode === 'production'\n    if (!isProd && config.mini?.debugReact !== true) {\n      // 不是生产环境，且没有设置 debugReact，则使用压缩版本的 react 依赖，减少体积\n      // 兼容pnpm workspace\n      const reactModulePath = require.resolve('react', { paths: [process.cwd()] })\n      const newFilePath = path.join(path.dirname(reactModulePath), 'cjs', 'react.production.min.js')\n\n      alias.set('react-reconciler$', 'react-reconciler/cjs/react-reconciler.production.min.js')\n      alias.set('react$', newFilePath)\n      alias.set('react/jsx-runtime$', 'react/cjs/react-jsx-runtime.production.min.js')\n\n      // 在React18中，使用了exports字段约定了模块暴露路径，其中并未暴露 ./cjs/ 。这将使上面的alias在编译时报错。相当的tricky。\n      // Why writeJson？ prebundle will load package.json via readFile to check exports property.\n      const reactPkgPath = require.resolve('react/package.json', { paths: [process.cwd()] })\n      if (reactPkgPath) {\n        const reactPkg = require('react/package.json')\n        const reactVersion = reactPkg.version || ''\n        if (/^[~^]?18/.test(reactVersion) && reactPkg.exports) {\n          reactPkg.exports = Object.assign(reactPkg.exports, {\n            './cjs/': './cjs/',\n          })\n          fs.writeJsonSync(reactPkgPath, reactPkg, { spaces: 2 })\n        }\n      }\n    }\n  }\n}\n\nfunction setLoader (framework: Frameworks, chain) {\n  chain.plugin('miniPlugin').tap((args) => {\n    args[0].loaderMeta = getLoaderMeta(framework)\n    return args\n  })\n}\n","import { fs } from '@tarojs/helper'\nimport { isString } from '@tarojs/shared'\n\nimport { modifyH5WebpackChain } from './webpack.h5'\nimport { modifyMiniWebpackChain } from './webpack.mini'\n\nimport type { esbuild } from '@tarojs/helper'\nimport type { IPluginContext } from '@tarojs/service'\n\nexport type Frameworks = 'react' | 'preact' | 'nerv'\n\nexport default (ctx: IPluginContext) => {\n  const { framework } = ctx.initialConfig\n\n  if (framework !== 'react' && framework !== 'nerv' && framework !== 'preact') return\n\n  ctx.modifyWebpackChain(({ chain }) => {\n    // 通用\n    setAlias(framework, chain)\n    chain\n      .plugin('definePlugin')\n      .tap(args => {\n        const config = args[0]\n        config.__TARO_FRAMEWORK__ = `\"${framework}\"`\n        return args\n      })\n\n    if (process.env.TARO_PLATFORM === 'web') {\n      // H5\n      modifyH5WebpackChain(ctx, framework, chain)\n    } else {\n      // 小程序\n      modifyMiniWebpackChain(ctx, framework, chain)\n    }\n  })\n\n  ctx.modifyRunnerOpts(({ opts }) => {\n    if (!opts?.compiler) return\n\n    if (isString(opts.compiler)) {\n      opts.compiler = {\n        type: opts.compiler\n      }\n    }\n\n    const { compiler } = opts\n    if (compiler.type === 'webpack5') {\n      // 提供给 webpack5 依赖预编译收集器的第三方依赖\n      const deps = [\n        'react',\n        'react-dom',\n        'react/jsx-runtime',\n        '@tarojs/plugin-framework-react/dist/runtime'\n      ]\n      compiler.prebundle ||= {}\n      const prebundleOptions = compiler.prebundle\n      prebundleOptions.include ||= []\n      prebundleOptions.include = prebundleOptions.include.concat(deps)\n      prebundleOptions.exclude ||= []\n      prebundleOptions.exclude.push(/mobx/) // 依赖会对 webpack 修改，默认排除\n      if (prebundleOptions.enable === false) return\n\n      const taroReactPlugin: esbuild.Plugin = {\n        name: 'taroReactPlugin',\n        setup (build) {\n          build.onLoad({ filter: /taro-h5[\\\\/]dist[\\\\/]api[\\\\/]taro/ }, ({ path }) => {\n            const content = fs.readFileSync(path).toString()\n            return {\n              contents: require('./api-loader')(content)\n            }\n          })\n        }\n      }\n\n      prebundleOptions.esbuild ||= {}\n      const esbuildConfig = prebundleOptions.esbuild\n      esbuildConfig.plugins ||= []\n      esbuildConfig.plugins.push(taroReactPlugin)\n    }\n  })\n}\n\nfunction setAlias (framework: Frameworks, chain) {\n  const alias = chain.resolve.alias\n\n  switch (framework) {\n    case 'preact':\n      alias.set('react', 'preact/compat')\n      alias.set('react-dom/test-utils', 'preact/test-utils')\n      alias.set('react-dom', 'preact/compat')\n      alias.set('react/jsx-runtime', 'preact/jsx-runtime')\n      break\n    case 'nerv':\n      alias.set('react$', 'nervjs')\n      alias.set('react-dom$', 'nervjs')\n      break\n  }\n}\n"],"names":["acorn","walk","setLoader","mergeWith","setAlias","fs","isString"],"mappings":"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"}